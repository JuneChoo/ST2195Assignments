install(rvest)
install.packages("httr")
install.packages("rvest")
library(rvest)
library(DBI)
library(RSQLite)
library(dplyr)
library(dbplyr)
conn <- dbConnect(RSQLite::SQLite(), "airline2.db")
q2 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("Code" = "Dest"))%>%
select (Description, n.total) %>%
arrange(desc(n.total))
ontime_db <- tbl(conn, "ontime")
setwd("~/")
setwd("D:\\SynologyDrive\\LSE\\2023\\ST2195 Programming for Data Science\\ST2195Assignments\\ST2195Assignments\\st2195_assignment_3")
conn <- dbConnect(RSQLite::SQLite(), "airline2.db")
q2 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("Code" = "Dest"))%>%
select (Description, n.total) %>%
arrange(desc(n.total))%>%
head(1) %>%
write.csv('q2.csv', row.names = T)
ontime_db <- tbl(conn, "ontime")
carriers_db <- tbl(conn, "carriers")
q2 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("Code" = "Dest"))%>%
select (Description, n.total) %>%
arrange(desc(n.total))%>%
head(1) %>%
write.csv('q2.csv', row.names = T)
q2 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("Code" = "Dest"))%>%
select (Description, n.total) %>%
arrange(desc(n_total))
q2 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("Code" = "Dest"))%>%
select (Description, n_total) %>%
arrange(desc(n_total))
show_query(q1)
show_query(q2)
airport_db <- tbl(conn, "airports")
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"))%>%
group_by(city) %>%
select (city, summarise(n = sum(n_total))) %>%
arrange(desc(n_total))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"))%>%
group_by(city) %>%
select (city, summarise(n = sum(n_total))) %>%
arrange(desc(n))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, summarise(n = sum(n_total.al)))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))
show_query(q2)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, summarise(n = sum(n_total)))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city) %>%
summarise(n = sum(n_total))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city) %>%
summarise(n =  sum(n_total))
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
select (city)
show_query(q2)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
select (city, n_total)
show_query(q2)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, n_total) %>%
summarise(n =  sum(n_total))
show_query(q2)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, n_total) %>%
summarise(n =  sum(n_total, na.rm = TRUE))%>%
arrange(desc(n))
show_query(q2)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, n_total) %>%
summarise(n =  sum(n_total, na.rm = TRUE))%>%
arrange(desc(n))%>%
head(1) %>%
write.csv('q2.csv', row.names = T)
q3 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DevDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(desc(n_avg))
q3 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(desc(n_avg))
dbListFields(conn, "ontime")
planes  <- tbl(conn, "plane-data")
planes  <- tbl(conn, "planes")
q3 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))
planes_db  <- tbl(conn, "planes")
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))
show_query(q3)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)
show_query(q3)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1) %>%
write.csv('q3.csv', row.names = T)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 | TailNum  %in% targets) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1)
targets <- c('737-230', 'ERJ 190-100 IGW', 'A330-223', '737-282')
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 | TailNum  %in% targets) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 | TailNum  %in% targets) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1) %>%
write.csv('q3.csv', row.names = T)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 ) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
filter(model  %in% targets)
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1) %>%
write.csv('q3.csv', row.names = T)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 ) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
filter(model %in% targets)%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1) %>%
write.csv('q3.csv', row.names = T)
q5 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 1) %>%
group_by(UniqueCarrier) %>%
summarise(n = n()),
by = c("Code" = "UniqueCarrier"))%>%
filter(Description  %in% targets)%>%
select (Description, n.cancelled) %>%
arrange(desc(n.cancelled))
q5 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 1) %>%
group_by(UniqueCarrier) %>%
summarise(n.cancelled = n()),
by = c("Code" = "UniqueCarrier"))%>%
filter(Description  %in% targets)%>%
select (Description, n.cancelled) %>%
arrange(desc(n.cancelled))
show_query(q5)
targets <- c('United Air Lines Inc.', 'American Airlines Inc.', 'Pinnacle Airlines Inc.', 'Delta Air Lines Inc.')
q5 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 1) %>%
group_by(UniqueCarrier) %>%
summarise(n.cancelled = n()),
by = c("Code" = "UniqueCarrier"))%>%
filter(Description  %in% targets)%>%
select (Description, n.cancelled) %>%
arrange(desc(n.cancelled))%>%
head(1) %>%
write.csv('q5.csv', row.names = T)
q1 = inner_join(carriers_db,
inner_join(ontime_db %>% group_by(UniqueCarrier) %>%  summarise(n = n()),
ontime_db %>%  filter(Cancelled == 1) %>% group_by(UniqueCarrier)
%>% summarise(n = n()),by = "UniqueCarrier",
suffix=c(".total", ".cancelled")),
by = c("Code" = "UniqueCarrier"))%>%
filter(Description  %in% targets)%>%
select (Description, n.total,n.cancelled) %>%
mutate(percent_c = (n.cancelled*100/n.total))%>%
arrange(desc(percent_c))%>%
head(1)
show_query(q1)
q2 = inner_join(airport_db, ontime_db %>%
filter(Cancelled == 0 ) %>%
group_by(Dest) %>%
summarise(n_total = n()),
by = c("iata" = "Dest"),
suffix=c(".ap", ".al"))%>%
group_by(city) %>%
select (city, n_total) %>%
summarise(n =  sum(n_total, na.rm = TRUE))%>%
arrange(desc(n))%>%
head(1)
show_query(q2)
q3 = inner_join(planes_db, ontime_db %>%
filter(Cancelled == 0 | Diverted == 0 ) %>%
group_by(TailNum) %>%
summarise(n_avg = mean(DepDelay)),
by = c("tailnum" = "TailNum"),
suffix=c(".ap", ".al"))%>%
filter(model %in% targets)%>%
group_by(model) %>%
select (model, n_avg) %>%
arrange(n_avg)%>%
head(1)
show_query(q3)
q5 = inner_join(carriers_db, ontime_db %>%
filter(Cancelled == 1) %>%
group_by(UniqueCarrier) %>%
summarise(n.cancelled = n()),
by = c("Code" = "UniqueCarrier"))%>%
filter(Description  %in% targets)%>%
select (Description, n.cancelled) %>%
arrange(desc(n.cancelled))%>%
head(1)
show_query(q5)
